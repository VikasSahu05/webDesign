PushWidgets.DoubleSlider=new Class({Implements:[Options,Events],options:{range:[0,100],start:[null,null],steps:null,precision:0,overlap:!1,values:[],displayValues:[],inlineLabel:"",inputNames:["min","max"]},initialize:function(t,s){this.setOptions(s),(t=$(t)).hasAttribute("data-setup-options")&&this.setOptions(JSON.parse(t.getAttribute("data-setup-options"))),this.initOptions(),this.values=this.options.start,this.element=t.addClass("doubleslider"),this.element.set("unselectable","on"),this.wrap=new Element("div",{class:"doubleslider-wrap",unselectable:"on"}).wraps(this.element),this.knobs=$$([new Element("div",{class:"doubleslider-knob",unselectable:"on"}),new Element("div",{class:"doubleslider-knob",unselectable:"on"})]).inject(this.element),this.rangeElement=new Element("div",{class:"doubleslider-range"}).inject(this.knobs[0],"after"),this.inputs=[],this.options.inputNames.each(function(t){this.inputs.push(new Element("input",{name:t,type:"hidden"}).inject(this.element))}.bind(this)),""!=this.options.inlineLabel&&new Element("div",{class:"doubleslider-inline-label",html:this.options.inlineLabel}).inject(this.wrap,"top"),this.attachDragInstances(),this.layoutElements(),this.onComplete(),window.addEvent("resize",this.layoutElements.bind(this).debounce(100,!1)),window.setTimeout(this.layoutElements.bind(this),1e3),this.element.addEvent("mousedown",function(t){t.target.className==this.element.className&&(this.onStart(),t=t.page.x-t.target.getCoordinates().left,Math.abs(this.getKnobOffset(0)+this.getKnobSize(0)-t)<Math.abs(this.getKnobOffset(1)-t)?(t-=this.getKnobSize(0),this.knobs[0].setStyle("left",t.limit(this.drags[0].options.limit.x[0],this.drags[0].options.limit.x[1]))):this.knobs[1].setStyle("left",t.limit(this.drags[1].options.limit.x[0],this.drags[1].options.limit.x[1])),this.onComplete())}.bind(this))},initOptions:function(){0!=this.options.values.length&&(this.options.precision=0,this.options.range=[0,this.options.values.length-1],this.options.displayValues.length!=this.options.values.length&&(this.options.displayValues=this.options.values),null!==this.options.start[0]&&(this.options.start[0]=this.options.values.indexOf(parseInt(this.options.start[0]))),null!==this.options.start[1]&&(this.options.start[1]=this.options.values.indexOf(parseInt(this.options.start[1]))),-1!=this.options.start[0]&&null!==this.options.start[0]||(this.options.start[0]=0),(this.options.start[1]<=0||null===this.options.start[1])&&(this.options.start[1]=this.options.values.length-1)),(null===this.options.start[0]||this.options.range[0]>this.options.start[0])&&(this.options.start[0]=this.options.range[0]),(null===this.options.start[1]||this.options.range[1]<this.options.start[1])&&(this.options.start[1]=this.options.range[1])},initDimensions:function(){this.offset=this.options.range[0],this.pixelRange=parseInt(this.element.getDimensions().width-this.getKnobSize(0)-this.getKnobSize(1)),this.range=this.options.range[1]-this.options.range[0]},setKnobPositions:function(){this.knobs[0].setStyle("left",this.translateRangeToPixel(this.values[0])+"px"),this.options.start[1]>this.options.start[0]?this.knobs[1].setStyle("left",this.translateRangeToPixel(this.values[1])+this.getKnobSize(0)+"px"):this.knobs[1].setStyle("left",this.getKnobOffset(0)+this.getKnobSize(0)+"px")},layoutElements:function(){this.initDimensions(),this.updateKnobLimits(),this.updateRangeElement(),this.setKnobPositions(),this.onComplete()},attachDragInstances:function(){var t={unit:"px",modifiers:{x:"left",y:"top"},onComplete:this.onComplete.bind(this),onDrag:this.onChange.debounce(15,!1).bind(this),onBeforeStart:this.onStart.bind(this),preventDefault:!0,snap:6};this.drags=[new Drag(this.knobs[0],t),new Drag(this.knobs[1],t)]},updateRangeElement:function(){var t=this.knobs[0].getStyle("left").toInt(),s=this.knobs[1].getStyle("left").toInt();null!==this.rangeElement&&(t=t+(this.getKnobSize(0)/2).round(0),this.rangeElement.setStyle("left",t+"px"),this.rangeElement.setStyle("width",s-t+(this.getKnobSize(1)/2).round(0)+"px"))},getKnobOffset:function(t){return this.knobs[t].getStyle("left").toInt()},getKnobSize:function(t){return!0===this.options.overlap?0:this.knobs[t].getDimensions().width.toInt()},updateKnobLimits:function(){var e={x:null,y:null};Object.each(e,function(t,s,i){"x"!=s&&(e[s]=[0,0])},this),this.drags[0].options.limit=Object.clone(e),this.drags[0].options.limit.x=[0,this.getKnobOffset(1)-this.getKnobSize(0)-.25*this.getKnobSize(0)],this.drags[1].options.limit=e,this.drags[1].options.limit.x=[this.getKnobOffset(0)+this.getKnobSize(0)+.25*this.getKnobSize(0),this.pixelRange+this.getKnobSize(1)]},onStart:function(t){this.pixelRange=parseInt(this.element.getDimensions().width-this.getKnobSize(0)-this.getKnobSize(1)),this.updateKnobLimits(),this.element.addClass("dragging"),this.fireEvent("start"),this.onChange(t)},translateRangeToPixel:function(t){return t-=this.offset,(this.pixelRange*t/this.range).round(this.options.precision)},translatePixelToRange:function(t){return(t*this.range/this.pixelRange+this.offset).round(this.options.precision)},onChange:function(){this.updateRangeElement(),this.values=[this.translatePixelToRange(this.getKnobOffset(0)),this.translatePixelToRange(this.getKnobOffset(1)-this.getKnobSize(1))],0<this.options.displayValues.length?(this.element.setAttribute("data-min-value-caption",this.options.displayValues[this.values[0]]),this.element.setAttribute("data-max-value-caption",this.options.displayValues[this.values[1]]),this.knobs[0].setAttribute("data-caption",this.options.displayValues[this.values[0]]),this.knobs[1].setAttribute("data-caption",this.options.displayValues[this.values[1]]),this.inputs[0].setAttribute("value",this.options.values[this.values[0]]),this.inputs[1].setAttribute("value",this.options.values[this.values[1]]),this.fireEvent("change",[this.options.values[this.values[0]],this.options.values[this.values[1]]])):(this.inputs[0].setAttribute("value",this.values[0]),this.inputs[1].setAttribute("value",this.values[1]),this.fireEvent("change",this.values[0],this.values[1]))},onComplete:function(t){this.element.removeClass("dragging"),this.onChange(t),this.fireEvent("complete")},setKnobs:function(t,s){null!==t&&(t<this.options.start[0]&&(t=this.options.start[0]),this.knobs[0].setStyle("left",this.translateRangeToPixel(t)+"px")),null!==s&&(s>this.options.start[1]&&(s=this.options.start[1]),this.knobs[1].setStyle("left",this.translateRangeToPixel(s)+this.getKnobSize(1)+"px")),this.onComplete()},setValue:function(t){"undefined"==t[0]&&(t[0]=this.options.values[0]),"undefined"==t[1]&&(t[1]=this.options.values[this.options.values.length-1]),this.values=t,this.setKnobs(this.options.values.indexOf(this.values[0]),this.options.values.indexOf(this.values[1])),this.onComplete()}}),PushWidgets.DoubleSlider.attach=function(t){t=t||document.body,$(t).getElements('[data-ui-role="doubleslider"][data-setup-options]').each(function(t,s){new PushWidgets.DoubleSlider(t),t.set("data-ui-role",null)})};