PushWidgets.WFScrollMonitor=new Class({Implements:[Events,Options],options:{onscroll:!0,onstatechange:!0,scrollout:!0,debounceInterval:300,tolerance:0,scrollParent:window},viewportSize:null,elements:null,initialize:function(t,e){return this.elements=t,this.setOptions(e),this.monitorFunc=null,$(this.options.scrollParent).addEvent("scroll",this.monitor.bind(this)),$(this.options.scrollParent).addEvent("resize",this.monitor.bind(this).debounce(this.options.debounceInterval,!1)),this.monitor.delay(this.options.debounceInterval,this,[!0]),this},monitor:function(){null!==this.monitorFunc&&PushWidgets.cancelAnimFrame(this.monitorFunc),this.monitorFunc=PushWidgets.requestAnimFrame(function(){var s,l=PushWidgets.getViewportSize().height;0<this.elements.length&&(s=$(this.options.scrollParent).getScroll().y,this.elements.each(function(t){var e,n,i,o;!0===this.options.onstatechange&&(n=(e=t.getBoundingClientRect().top+this.options.tolerance)+t.offsetHeight,i=t.hasAttribute("scrolledin"),o=t.getCoordinates(),0<=e&&e<=l||e<=0&&l<=n||0<=n&&n<=l?(i||(t.setAttribute("scrolledin",""),this.fireEvent("scrolledin",[t,s,o])),!0===this.options.onscroll&&this.fireEvent("scrolled",[t,s,o])):i&&!0===this.options.scrollout&&(t.removeAttribute("scrolledin",""),this.fireEvent("scrolledout",[t,s,o])))}.bind(this))),this.monitorFunc=null},this)},addElement:function(t){this.elements.push($(t)),this.monitor(!0)},removeElement:function(t){this.elements.erase($(t)),this.monitor(!0)}});