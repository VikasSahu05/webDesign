!function(e,s){"use strict";PushWidgets.WFCarousel=new Class({Implements:[Events,Options],wrap:null,container:null,elements:null,currentIndex:0,columns:0,itemPixelWidth:0,timer:null,options:{dragThreshold:20,minColWidth:280,maxColWidth:0,startIndex:0,overflowStyle:"hidden",interval:5e3,wrapAround:!0,advanceMode:"single",doThumbs:!0,thumbnailHolder:"~ .car-thumbs",nextClicker:"~ .car-next",prevClicker:"~ .car-prev",forceIntegerPixels:!0},initialize:function(t,e){return this.container=$(t).addClass("carousel"),this.setOptions(e),this.container.getAttribute("data-carousel-setup")&&this.setOptions(JSON.parse(this.container.getAttribute("data-carousel-setup"))),this.container.getAttribute("data-setup-options")&&this.setOptions(JSON.parse(this.container.getAttribute("data-setup-options"))),this.options.maxColWidth<this.options.minColWidth&&(this.options.maxColWidth=1.5*this.options.minColWidth),this.options.wrapAround="single"===this.options.advanceMode&&this.options.wrapAround,this.setupCarousel(),this.setCurrentIndex(this.currentIndex),this.layoutElements(),this},setupCarousel:function(){this.wrap=new Element("div",{class:"carousel-wrap"}).setStyles({margin:0,padding:0}).forceStyle("display","block").forceStyle("overflow",this.options.overflowStyle).wraps(this.container),this.wrapwrap=new Element("div",{class:"carousel-wrapwrap"}).setStyles({margin:0,padding:0}).forceStyle("display","block").forceStyle("overflow",this.options.overflowStyle).wraps(this.wrap),this.options.doThumbs&&0<!!this.wrap.getElements(this.options.thumbnailHolder).length?this.thumbs=this.wrap.getElements(this.options.thumbnailHolder)[0]:this.options.doThumbs&&(this.thumbs=new Element("div",{class:"car-thumbs"}).inject(this.wrap,"after"));try{this.options.nextClicker&&this.wrapwrap.getElements(this.options.nextClicker).addEvent("click",this.next.bind(this)),this.options.prevClicker&&this.wrapwrap.getElements(this.options.prevClicker).addEvent("click",this.prev.bind(this))}catch(t){PushWidgets.debug(t)}this.dragInstance=new Drag(this.container,{modifiers:{x:"azumith",y:""},snap:this.options.dragThreshold,preventDefault:!1,unDraggableTags:["button","input","textarea","select","option"]});var t=function(t){Math.abs(this.dragInstance.value.now.x)>this.options.dragThreshold&&(t.preventDefault(),t.stopPropagation())}.bind(this);e.addEvent("resize",this.layoutElements.bind(this).debounce(150,!1)),this.container.addEvents({click:t}),this.dragInstance.addEvents({start:function(){this.container.addClass("dragging")}.bind(this),drag:function(){var t=this.dragInstance.value.now.x,t=-this.itemPixelWidth*this.currentIndex+t;this.container.setStyles({transform:"translate3d("+t+"px,0,0)",msTransform:"translate("+t+"px, 0)","-webkit-transform":"translate3d("+t+"px,0,0)"})}.bind(this),complete:function(t,e){this.container.removeClass("dragging");var s=this.dragInstance.value.now.x,i="single"===this.options.advanceMode?Math.round(Math.abs(s)/this.itemPixelWidth+.5):Math.max(Math.round(Math.abs(s)/this.itemPixelWidth+.5),this.columns);parseInt(s)<-this.options.dragThreshold?(e.preventDefault(),this.setCurrentIndex(this.currentIndex+i)):parseInt(s)>this.options.dragThreshold?(e.preventDefault(),this.setCurrentIndex(this.currentIndex-i)):this.setCurrentIndex(this.currentIndex),this.container.setStyle("azumith",0)}.bind(this)}),this.elements=this.container.getChildren().setStyles({display:"inline-block"}),this.wrap.setAttribute("data-last-index",this.elements.length),this.layoutElements()},layoutElements:function(){var t=this.wrap.measure(function(){return this.setStyle("width",null),this.getSize()});this.columns=Math.max(1,Math.min(parseInt(t.x/this.options.minColWidth),this.elements.length)),this.fireEvent("beforeReflow",[this.columns]),this.itemPixelWidth=this.options.forceIntegerPixels?t.x/this.columns:Math.round(t.x/this.columns),this.itemPixelWidth>this.options.maxColWidth?(this.itemPixelWidth=this.options.maxColWidth,this.wrap.setStyle("text-align","center"),this.wrap.setStyle("width","100%")):(this.wrap.setStyle("text-align","left"),this.wrap.setStyle("width",100*this.elements.length+"vw")),this.elements.setStyle("width",this.itemPixelWidth+"px"),this.setCurrentIndex(this.currentIndex),this.wrap.setAttribute("data-slide-count",this.elements.length),this.fireEvent("reflow",[this.columns]),this.dragInstance.setOptions({limit:{x:[-this.itemPixelWidth*this.columns*.9,this.itemPixelWidth*this.columns*.9],y:[]}}),this.options.doThumbs&&this.thumbs&&("single"===this.options.advanceMode&&this.elements.length>this.columns?this.thumbs.set("html","<span></span>".repeat(this.elements.length-this.columns+1)):"single"!==this.options.advanceMode&&1<this.elements.length/this.columns?this.thumbs.set("html","<span></span>".repeat(Math.ceil(this.elements.length/this.columns))):this.thumbs.set("html",""),this.thumbs.addEvent("click:relay(span)",function(t,e){this.setCurrentIndex(this.thumbs.getChildren().indexOf(e))}.bind(this)))},setCurrentIndex:function(t){this.fireEvent("beforeChange",[this.currentIndex,this.currentIndex+this.columns-1]),"next"==t?t=this.currentIndex+("single"==this.options.advanceMode?1:this.columns):"prev"==t&&(t=this.currentIndex-("single"==this.options.advanceMode?1:this.columns)),t<0&&(t=!0===this.options.wrapAround?this.elements.length-this.columns:0),t=!0===this.options.wrapAround?parseInt(t)%(this.elements.length-this.columns+1):Math.min(t,this.elements.length-this.columns),this.currentIndex=t,"single"===this.options.advanceMode?this.wrap.setAttribute("data-current-slide",t+1):this.wrap.setAttribute("data-current-slide",Math.ceil(t/this.columns)+1),this.elements.length==this.columns?this.wrap.setAttribute("data-status","allvisible"):this.elements.length-this.columns==t?this.wrap.setAttribute("data-status","end"):0==t?this.wrap.setAttribute("data-status","start"):this.wrap.removeAttribute("data-status");t=this.options.forceIntegerPixels?Math.round(-this.itemPixelWidth*this.currentIndex):-this.itemPixelWidth*this.currentIndex;this.container.setStyles({transform:"translate3d("+t+"px,0,0)",msTransform:"translate("+t+"px,0)","-webkit-transform":"translate3d("+t+"px,0,0)"}),this.fireEvent("change",[this.currentIndex,this.currentIndex+this.columns-1])},next:function(){this.setCurrentIndex("next"),null!==this.timer&&this.stop()},prev:function(){this.setCurrentIndex("prev"),null!==this.timer&&this.stop()},play:function(t){this.timer=this.setCurrentIndex.periodical(t||this.options.interval,this,["autoPlay"])},autoPlay:function(){this.setCurrentIndex("next")},stop:function(){clearInterval(this.timer),this.timer=null},start:function(){this.play()}.bind(this)}),PushWidgets.WFCarousel.attach=function(t){t=t||s.body,$(t).getElements('[data-ui-role="carousel"]').each(function(t){new PushWidgets.WFCarousel(t),t.set("data-ui-role",null)})}}(window,document);