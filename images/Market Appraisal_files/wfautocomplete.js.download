!function(i,s){"use strict";PushWidgets.WFAutoComplete=new Class({Implements:[Events,Options],options:{action:null,param:"search",method:"get",minlength:2,className:"autocomplete"},inputElement:null,dropdownList:null,xhrInstance:null,suggestions:null,cache:[],initialize:function(t,e){this.setOptions(e),t.hasAttribute("data-setup-options")&&this.setOptions(JSON.parse(t.getAttribute("data-setup-options"))),void 0!==t&&"input"==t.tagName.toLowerCase()||PushWidgets.debug("AutocompleteElement does not exist",t,this.options),this.inputElement=t,this.inputElement.setAttribute("autocomplete","off"),this.wrap=new Element("div",{id:this.id,class:this.options.className,styles:{position:"relative"},"aria-haspopup":"listbox","aria-expanded":"false"}).wraps(this.inputElement),!this.options.action&&""!=this.inputElement.getAttribute("datalist")&&$(this.inputElement.getAttribute("datalist"))&&(this.suggestions=[],$(this.inputElement.getAttribute("datalist")).getElements("option").each(function(){this.suggestions.push(t.value)}.bind(this))),this.dropdownList=this.createListElement(),this.dropdownList.addEvent("click:relay(li)",function(t,e){t.stop(),this.inputElement.set("value",e.get("text")),this.positionDropdown(!1)}.bind(this)),this.inputElement.addEvent("keydown",function(t){var e;this.dropdownList.isVisible()&&["up","down","tab","enter","home","end","esc"].contains(t.key)&&(("home"!=t.key&&"end"!=t.key||t.shiftKey)&&"enter"!=t.key||t.stop(),(e=this.selectItem(t.key))&&this.inputElement.set("value",e.get("text")),"enter"!=t.key&&"esc"!=t.key||this.positionDropdown(!1)),this.dropdownList.isVisible()||"down"!=t.key||(this.getSuggestions(),t.stop())}.bind(this)),this.inputElement.addEvent("blur",function(){""==this.inputElement.get("value")&&this.fireEvent("onSelected",[null,null]),this.positionDropdown.debounce(200,!1,[!1])}.bind(this)),this.inputElement.addEvent("keyup",function(t){["up","down","left","right","tab","enter","esc","home","end"].contains(t.key)||this.getSuggestions()}.bind(this)),this.inputElement.addEvent("dblclick",this.getSuggestions.bind(this)),0==this.options.minlength&&this.inputElement.addEvent("focus",this.getSuggestions.bind(this)),this.positionDropdown(),i.addEvent("resize",this.positionDropdown.bind(this).debounce(100,!1)),this.dropdownList.addEvent("mouseenter:relay(li)",function(t,e){e.getSiblings().removeClass("selected"),e.addClass("selected")}),this.dropdownList.addEvent("mouseleave:relay(li)",function(t,e){e.removeClass("selected")})},selectItem:function(e){var i=!1,s=this.dropdownList.getChildren();return 0!=s.length&&(s.each(function(t){if(!i&&t.hasClass("selected"))switch(["up","down","home","end"].contains(e)&&(t.removeClass("selected"),t.removeAttribute("aria-selected")),e){case"up":i=null==t.getPrevious()?s[0]:t.getPrevious();break;case"down":i=null==t.getNext()?s[s.length-1]:t.getNext();break;case"home":i=s[0];break;case"end":i=s[s.length-1];break;case"tab":case"enter":i=t}}),!i&&["up","down","home","end"].contains(e)&&(i=s[0]),i&&(i.addClass("selected"),i.setAttribute("aria-selected","true"),this.dropdownList.scrollTo(0,i.getPosition().y-this.dropdownList.getPosition().y)),i)},getSuggestions:function(){""!=this.inputElement.value.trim()&&this.inputElement.value.length>=this.options.minlength?null===this.action&&0<this.suggestions.length?this.showSuggestions(this.suggestions.filter(function(t){return!!t.match(new RegExp(this.inputElement.value+".*"))}.bind(this))):this.suggestions&&this.suggestions[0]==this.inputElement.get("value")||(this.cache[this.inputElement.get("value")]?this.showSuggestions(this.cache[this.inputElement.get("value")]):(null===this.xhrInstance&&(this.xhrInstance=new Request.JSON({url:this.options.action,method:this.options.method,onSuccess:function(t){this.suggestions=t,this.cache[this.inputElement.get("value")]=t,this.showSuggestions(this.suggestions)}.bind(this)})),this.xhrInstance.send(this.options.param+"="+this.inputElement.get("value")))):this.positionDropdown(!1)}.debounce(300,!1),showSuggestions:function(t){this.dropdownList.empty(),0<t.length?(t.each(function(t){this.createListItem(t).inject(this.dropdownList,"bottom")}.bind(this)),this.positionDropdown(!0)):this.positionDropdown(!1)},positionDropdown:function(t){if(this.dropdownList.setStyles({display:"none",visibility:"hidden","clip-path":"polygon(0px 0px, 0px 0px, 0px 0px, 0px 0px)",clip:"rect(0, 0, 0, 0)"}),!t)return this.dropdownList.set("aria-hidden","true"),void this.wrap.set("aria-expanded","false");var e=this.wrap.getBoundingClientRect(),t=this.dropdownList.measure(function(){return this.getSize()});this.dropdownList.setStyles({width:e.width,"z-index":"5"}),e.top+t.y<(i.innerHeight||s.documentElement.clientHeight)?this.dropdownList.setStyles({top:"100%",left:0,right:"auto",bottom:"auto",position:"absolute"}):this.dropdownList.setStyles({bottom:"100%",left:0,right:"auto",top:"auto",position:"absolute"}),this.dropdownList.setStyles({display:"block",visibility:"visible","clip-path":"none",clip:null}),this.dropdownList.set("aria-hidden","false"),this.wrap.set("aria-expanded","true")},createListItem:function(t){return new Element("li",{text:t,role:"option"})},createListElement:function(){return new Element("ul",{class:this.options.className+"-listbox",styles:{display:"none"},role:"listbox"}).inject(this.wrap,"bottom")}}),PushWidgets.WFAutoComplete.attach=function(t){t=t||s.body,$(t).getElements('[data-ui-role="autocomplete"][data-setup-options]').each(function(t){new PushWidgets.WFAutoComplete(t),t.set("data-ui-role",null)})}}(window,document);